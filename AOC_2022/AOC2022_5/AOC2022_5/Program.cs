var rawStacksInput = "    [C]         [Q]         [V]    \r\n    [D]         [D] [S]     [M] [Z]\r\n    [G]     [P] [W] [M]     [C] [G]\r\n    [F]     [Z] [C] [D] [P] [S] [W]\r\n[P] [L]     [C] [V] [W] [W] [H] [L]\r\n[G] [B] [V] [R] [L] [N] [G] [P] [F]\r\n[R] [T] [S] [S] [S] [T] [D] [L] [P]\r\n[N] [J] [M] [L] [P] [C] [H] [Z] [R]";
var stacksInput = rawStacksInput.Split("\r\n")
                                .Reverse().Select(s => s.Split("    ")
                                .SelectMany(a => 
                                    a.Replace("[", "")
                                    .Replace("]", "")
                                    .Split(" "))
                                    .ToArray()
                                  ).ToArray();

var stacksList = new List<Stack<char>>();
var stacksList2 = new List<Stack<char>>();
for (int i = 0; i < stacksInput.First().Count(); i++)
{
    var stack = new Stack<char>();
    var stack2 = new Stack<char>();
    for (int j = 0; j < stacksInput.Count(); j++)
    {
        var c = stacksInput[j][i];
        if (string.IsNullOrEmpty(c))
            continue;

        stack.Push(c[0]);
        stack2.Push(c[0]);
    }
    stacksList.Add(stack);
    stacksList2.Add(stack2);
}

var rawInputMoves = "move 2 from 4 to 6\r\nmove 4 from 5 to 3\r\nmove 6 from 6 to 1\r\nmove 4 from 1 to 4\r\nmove 4 from 9 to 4\r\nmove 7 from 2 to 4\r\nmove 1 from 9 to 3\r\nmove 1 from 2 to 6\r\nmove 2 from 9 to 5\r\nmove 2 from 6 to 8\r\nmove 5 from 8 to 1\r\nmove 2 from 6 to 9\r\nmove 5 from 8 to 3\r\nmove 1 from 5 to 4\r\nmove 3 from 7 to 2\r\nmove 10 from 4 to 7\r\nmove 7 from 4 to 3\r\nmove 1 from 4 to 7\r\nmove 1 from 7 to 9\r\nmove 1 from 2 to 3\r\nmove 11 from 1 to 7\r\nmove 12 from 3 to 7\r\nmove 8 from 3 to 8\r\nmove 29 from 7 to 2\r\nmove 3 from 7 to 3\r\nmove 3 from 9 to 2\r\nmove 4 from 5 to 3\r\nmove 7 from 3 to 5\r\nmove 28 from 2 to 3\r\nmove 1 from 7 to 5\r\nmove 2 from 8 to 5\r\nmove 2 from 4 to 1\r\nmove 2 from 1 to 4\r\nmove 1 from 7 to 6\r\nmove 1 from 7 to 1\r\nmove 3 from 2 to 8\r\nmove 1 from 1 to 7\r\nmove 9 from 5 to 3\r\nmove 12 from 3 to 1\r\nmove 1 from 4 to 3\r\nmove 1 from 6 to 4\r\nmove 3 from 2 to 9\r\nmove 16 from 3 to 7\r\nmove 2 from 9 to 6\r\nmove 5 from 7 to 2\r\nmove 1 from 9 to 7\r\nmove 1 from 4 to 2\r\nmove 13 from 7 to 2\r\nmove 13 from 2 to 7\r\nmove 12 from 7 to 8\r\nmove 2 from 6 to 4\r\nmove 16 from 8 to 1\r\nmove 4 from 3 to 1\r\nmove 3 from 3 to 2\r\nmove 1 from 5 to 7\r\nmove 1 from 5 to 3\r\nmove 3 from 4 to 6\r\nmove 19 from 1 to 3\r\nmove 5 from 8 to 4\r\nmove 6 from 3 to 2\r\nmove 5 from 4 to 2\r\nmove 1 from 7 to 4\r\nmove 1 from 4 to 9\r\nmove 3 from 6 to 7\r\nmove 1 from 9 to 2\r\nmove 16 from 2 to 4\r\nmove 9 from 1 to 8\r\nmove 10 from 4 to 2\r\nmove 2 from 7 to 5\r\nmove 5 from 8 to 4\r\nmove 12 from 2 to 9\r\nmove 2 from 7 to 4\r\nmove 12 from 9 to 5\r\nmove 11 from 5 to 6\r\nmove 3 from 1 to 9\r\nmove 1 from 5 to 7\r\nmove 2 from 9 to 2\r\nmove 10 from 3 to 2\r\nmove 1 from 9 to 2\r\nmove 2 from 8 to 9\r\nmove 1 from 7 to 8\r\nmove 1 from 8 to 4\r\nmove 7 from 2 to 6\r\nmove 1 from 1 to 5\r\nmove 5 from 3 to 1\r\nmove 1 from 5 to 1\r\nmove 2 from 3 to 9\r\nmove 2 from 1 to 6\r\nmove 3 from 9 to 8\r\nmove 14 from 6 to 1\r\nmove 1 from 3 to 5\r\nmove 5 from 4 to 6\r\nmove 1 from 9 to 6\r\nmove 7 from 6 to 9\r\nmove 1 from 6 to 2\r\nmove 8 from 1 to 4\r\nmove 7 from 1 to 7\r\nmove 10 from 2 to 1\r\nmove 4 from 7 to 6\r\nmove 10 from 4 to 6\r\nmove 5 from 8 to 2\r\nmove 1 from 5 to 9\r\nmove 2 from 2 to 6\r\nmove 2 from 4 to 7\r\nmove 1 from 2 to 7\r\nmove 5 from 9 to 2\r\nmove 1 from 2 to 9\r\nmove 14 from 6 to 8\r\nmove 2 from 8 to 4\r\nmove 1 from 2 to 6\r\nmove 4 from 9 to 3\r\nmove 2 from 6 to 8\r\nmove 5 from 4 to 5\r\nmove 5 from 8 to 3\r\nmove 1 from 2 to 4\r\nmove 3 from 7 to 1\r\nmove 2 from 2 to 7\r\nmove 1 from 4 to 7\r\nmove 1 from 4 to 5\r\nmove 1 from 2 to 8\r\nmove 1 from 4 to 9\r\nmove 8 from 8 to 2\r\nmove 3 from 1 to 5\r\nmove 7 from 2 to 9\r\nmove 8 from 1 to 6\r\nmove 6 from 7 to 2\r\nmove 2 from 2 to 8\r\nmove 5 from 1 to 8\r\nmove 3 from 6 to 8\r\nmove 4 from 3 to 6\r\nmove 3 from 6 to 2\r\nmove 8 from 9 to 2\r\nmove 11 from 5 to 7\r\nmove 12 from 2 to 6\r\nmove 2 from 3 to 7\r\nmove 12 from 7 to 2\r\nmove 10 from 6 to 9\r\nmove 1 from 7 to 1\r\nmove 12 from 8 to 7\r\nmove 2 from 3 to 2\r\nmove 8 from 9 to 7\r\nmove 6 from 2 to 5\r\nmove 1 from 1 to 6\r\nmove 3 from 2 to 6\r\nmove 1 from 3 to 7\r\nmove 5 from 5 to 3\r\nmove 10 from 7 to 2\r\nmove 2 from 3 to 7\r\nmove 8 from 7 to 6\r\nmove 20 from 2 to 8\r\nmove 5 from 8 to 1\r\nmove 5 from 8 to 6\r\nmove 1 from 5 to 7\r\nmove 1 from 1 to 4\r\nmove 4 from 1 to 2\r\nmove 1 from 9 to 6\r\nmove 3 from 3 to 1\r\nmove 4 from 7 to 5\r\nmove 1 from 9 to 8\r\nmove 11 from 8 to 7\r\nmove 1 from 4 to 9\r\nmove 2 from 7 to 5\r\nmove 31 from 6 to 9\r\nmove 4 from 2 to 3\r\nmove 6 from 5 to 1\r\nmove 4 from 1 to 2\r\nmove 7 from 7 to 8\r\nmove 1 from 7 to 6\r\nmove 1 from 1 to 7\r\nmove 24 from 9 to 4\r\nmove 2 from 7 to 8\r\nmove 2 from 9 to 2\r\nmove 2 from 7 to 5\r\nmove 2 from 5 to 9\r\nmove 3 from 4 to 1\r\nmove 20 from 4 to 2\r\nmove 1 from 6 to 1\r\nmove 16 from 2 to 1\r\nmove 4 from 3 to 1\r\nmove 1 from 4 to 8\r\nmove 5 from 8 to 5\r\nmove 5 from 8 to 1\r\nmove 1 from 5 to 2\r\nmove 3 from 5 to 6\r\nmove 33 from 1 to 6\r\nmove 6 from 9 to 4\r\nmove 15 from 6 to 7\r\nmove 6 from 4 to 3\r\nmove 1 from 5 to 3\r\nmove 7 from 3 to 9\r\nmove 11 from 7 to 5\r\nmove 10 from 5 to 8\r\nmove 2 from 7 to 3\r\nmove 5 from 8 to 9\r\nmove 1 from 7 to 5\r\nmove 1 from 5 to 8\r\nmove 1 from 5 to 7\r\nmove 2 from 3 to 8\r\nmove 2 from 7 to 5\r\nmove 2 from 8 to 7\r\nmove 1 from 5 to 9\r\nmove 1 from 7 to 6\r\nmove 3 from 8 to 6\r\nmove 22 from 6 to 9\r\nmove 1 from 7 to 6\r\nmove 27 from 9 to 4\r\nmove 18 from 4 to 8\r\nmove 5 from 4 to 1\r\nmove 1 from 5 to 1\r\nmove 3 from 6 to 3\r\nmove 2 from 3 to 5\r\nmove 2 from 5 to 2\r\nmove 1 from 2 to 6\r\nmove 1 from 6 to 3\r\nmove 9 from 8 to 6\r\nmove 3 from 9 to 8\r\nmove 9 from 6 to 5\r\nmove 1 from 6 to 9\r\nmove 15 from 8 to 5\r\nmove 1 from 3 to 4\r\nmove 6 from 1 to 8\r\nmove 1 from 3 to 7\r\nmove 8 from 5 to 8\r\nmove 2 from 5 to 6\r\nmove 3 from 4 to 6\r\nmove 1 from 7 to 6\r\nmove 2 from 5 to 3\r\nmove 5 from 5 to 1\r\nmove 2 from 3 to 7\r\nmove 1 from 8 to 1\r\nmove 10 from 2 to 9\r\nmove 5 from 6 to 3\r\nmove 7 from 8 to 5\r\nmove 4 from 3 to 5\r\nmove 1 from 2 to 1\r\nmove 2 from 7 to 6\r\nmove 5 from 1 to 5\r\nmove 1 from 3 to 7\r\nmove 1 from 7 to 6\r\nmove 3 from 8 to 5\r\nmove 4 from 6 to 4\r\nmove 1 from 2 to 9\r\nmove 5 from 4 to 6\r\nmove 21 from 5 to 3\r\nmove 2 from 8 to 4\r\nmove 3 from 4 to 1\r\nmove 1 from 8 to 4\r\nmove 18 from 3 to 5\r\nmove 2 from 3 to 6\r\nmove 2 from 6 to 9\r\nmove 2 from 6 to 2\r\nmove 1 from 2 to 9\r\nmove 19 from 9 to 4\r\nmove 3 from 6 to 3\r\nmove 2 from 9 to 4\r\nmove 1 from 1 to 2\r\nmove 1 from 3 to 7\r\nmove 16 from 5 to 2\r\nmove 4 from 1 to 9\r\nmove 3 from 3 to 4\r\nmove 4 from 9 to 8\r\nmove 3 from 5 to 1\r\nmove 22 from 4 to 5\r\nmove 1 from 7 to 2\r\nmove 22 from 5 to 9\r\nmove 2 from 5 to 2\r\nmove 2 from 4 to 6\r\nmove 10 from 9 to 5\r\nmove 1 from 8 to 3\r\nmove 13 from 9 to 2\r\nmove 1 from 6 to 3\r\nmove 19 from 2 to 7\r\nmove 2 from 7 to 4\r\nmove 1 from 8 to 4\r\nmove 1 from 8 to 2\r\nmove 11 from 5 to 7\r\nmove 3 from 1 to 7\r\nmove 8 from 7 to 8\r\nmove 1 from 3 to 5\r\nmove 1 from 8 to 3\r\nmove 1 from 5 to 3\r\nmove 6 from 2 to 3\r\nmove 1 from 8 to 7\r\nmove 1 from 6 to 1\r\nmove 1 from 1 to 8\r\nmove 4 from 8 to 1\r\nmove 1 from 4 to 6\r\nmove 8 from 3 to 9\r\nmove 2 from 2 to 3\r\nmove 3 from 8 to 5\r\nmove 1 from 8 to 2\r\nmove 4 from 2 to 7\r\nmove 5 from 9 to 7\r\nmove 1 from 6 to 3\r\nmove 4 from 2 to 4\r\nmove 23 from 7 to 5\r\nmove 4 from 1 to 2\r\nmove 3 from 9 to 6\r\nmove 2 from 4 to 8\r\nmove 2 from 8 to 3\r\nmove 2 from 6 to 1\r\nmove 1 from 6 to 8\r\nmove 8 from 5 to 3\r\nmove 5 from 2 to 6\r\nmove 5 from 6 to 3\r\nmove 1 from 8 to 3\r\nmove 4 from 4 to 7\r\nmove 15 from 5 to 2\r\nmove 1 from 1 to 9\r\nmove 2 from 5 to 1\r\nmove 4 from 3 to 7\r\nmove 1 from 4 to 9\r\nmove 4 from 7 to 1\r\nmove 2 from 5 to 6\r\nmove 7 from 1 to 2\r\nmove 6 from 2 to 3\r\nmove 16 from 2 to 5\r\nmove 1 from 6 to 3\r\nmove 1 from 6 to 3\r\nmove 9 from 7 to 4\r\nmove 6 from 4 to 6\r\nmove 1 from 9 to 8\r\nmove 23 from 3 to 9\r\nmove 1 from 3 to 4\r\nmove 3 from 4 to 5\r\nmove 9 from 5 to 2\r\nmove 6 from 9 to 7\r\nmove 7 from 7 to 5\r\nmove 5 from 5 to 3\r\nmove 1 from 4 to 6\r\nmove 3 from 3 to 8\r\nmove 6 from 2 to 1\r\nmove 3 from 5 to 6\r\nmove 4 from 7 to 1\r\nmove 2 from 3 to 9\r\nmove 5 from 6 to 8\r\nmove 19 from 9 to 6\r\nmove 1 from 9 to 2\r\nmove 9 from 5 to 9\r\nmove 4 from 8 to 3\r\nmove 5 from 6 to 1\r\nmove 4 from 6 to 1\r\nmove 2 from 3 to 8\r\nmove 17 from 1 to 7\r\nmove 2 from 1 to 2\r\nmove 6 from 6 to 9\r\nmove 4 from 8 to 5\r\nmove 3 from 8 to 2\r\nmove 3 from 5 to 6\r\nmove 4 from 6 to 8\r\nmove 2 from 6 to 9\r\nmove 4 from 8 to 7\r\nmove 9 from 9 to 5\r\nmove 5 from 9 to 4\r\nmove 7 from 2 to 8\r\nmove 1 from 2 to 1\r\nmove 3 from 6 to 5\r\nmove 6 from 8 to 5\r\nmove 1 from 3 to 4\r\nmove 1 from 3 to 1\r\nmove 12 from 7 to 2\r\nmove 5 from 2 to 7\r\nmove 8 from 7 to 5\r\nmove 1 from 9 to 3\r\nmove 5 from 2 to 8\r\nmove 3 from 6 to 3\r\nmove 2 from 2 to 3\r\nmove 1 from 2 to 4\r\nmove 2 from 3 to 4\r\nmove 1 from 1 to 6\r\nmove 14 from 5 to 6\r\nmove 1 from 8 to 6\r\nmove 3 from 3 to 7\r\nmove 4 from 7 to 1\r\nmove 9 from 4 to 3\r\nmove 3 from 1 to 4\r\nmove 1 from 1 to 2\r\nmove 1 from 8 to 4\r\nmove 8 from 3 to 1\r\nmove 1 from 3 to 2\r\nmove 5 from 7 to 6\r\nmove 3 from 1 to 6\r\nmove 2 from 2 to 8\r\nmove 13 from 5 to 3\r\nmove 5 from 1 to 3\r\nmove 3 from 4 to 5\r\nmove 1 from 9 to 2\r\nmove 4 from 3 to 9\r\nmove 1 from 1 to 7\r\nmove 2 from 5 to 8\r\nmove 1 from 7 to 5\r\nmove 2 from 5 to 4\r\nmove 1 from 2 to 6\r\nmove 1 from 4 to 5\r\nmove 7 from 3 to 6\r\nmove 31 from 6 to 1\r\nmove 25 from 1 to 7\r\nmove 2 from 3 to 2\r\nmove 13 from 7 to 9\r\nmove 1 from 1 to 6\r\nmove 1 from 4 to 1\r\nmove 2 from 2 to 9\r\nmove 1 from 4 to 6\r\nmove 3 from 7 to 1\r\nmove 7 from 8 to 3\r\nmove 1 from 8 to 2\r\nmove 1 from 2 to 8\r\nmove 4 from 3 to 4\r\nmove 1 from 8 to 7\r\nmove 3 from 6 to 9\r\nmove 5 from 7 to 6\r\nmove 1 from 4 to 7\r\nmove 5 from 7 to 9\r\nmove 5 from 3 to 6\r\nmove 3 from 4 to 7\r\nmove 1 from 5 to 4\r\nmove 4 from 7 to 9\r\nmove 32 from 9 to 1\r\nmove 1 from 6 to 5\r\nmove 1 from 5 to 9\r\nmove 4 from 3 to 8\r\nmove 5 from 1 to 4\r\nmove 4 from 4 to 9\r\nmove 6 from 1 to 7\r\nmove 4 from 9 to 8\r\nmove 4 from 7 to 8\r\nmove 1 from 7 to 1\r\nmove 1 from 7 to 6\r\nmove 7 from 6 to 3\r\nmove 1 from 9 to 5\r\nmove 2 from 4 to 7\r\nmove 25 from 1 to 6\r\nmove 1 from 7 to 1\r\nmove 1 from 3 to 4\r\nmove 18 from 6 to 8\r\nmove 1 from 5 to 1\r\nmove 3 from 1 to 6\r\nmove 21 from 8 to 3\r\nmove 1 from 8 to 4\r\nmove 2 from 4 to 2\r\nmove 1 from 8 to 1\r\nmove 1 from 7 to 6\r\nmove 5 from 6 to 3\r\nmove 30 from 3 to 1\r\nmove 4 from 8 to 6\r\nmove 1 from 2 to 9\r\nmove 1 from 8 to 5\r\nmove 9 from 6 to 5\r\nmove 2 from 8 to 7\r\nmove 3 from 5 to 9\r\nmove 2 from 3 to 4\r\nmove 1 from 2 to 1\r\nmove 1 from 5 to 8\r\nmove 1 from 8 to 3\r\nmove 2 from 4 to 6\r\nmove 1 from 3 to 1\r\nmove 1 from 5 to 6\r\nmove 5 from 5 to 7\r\nmove 4 from 6 to 8\r\nmove 3 from 8 to 2\r\nmove 1 from 1 to 5\r\nmove 1 from 8 to 7\r\nmove 4 from 9 to 6\r\nmove 1 from 5 to 1\r\nmove 4 from 6 to 8\r\nmove 6 from 7 to 3\r\nmove 4 from 3 to 9\r\nmove 2 from 2 to 7\r\nmove 1 from 3 to 5\r\nmove 3 from 7 to 6\r\nmove 2 from 9 to 8\r\nmove 1 from 2 to 4\r\nmove 1 from 3 to 4\r\nmove 5 from 8 to 4\r\nmove 1 from 9 to 2\r\nmove 1 from 7 to 5\r\nmove 3 from 4 to 5\r\nmove 1 from 9 to 1\r\nmove 1 from 2 to 7\r\nmove 1 from 7 to 1\r\nmove 5 from 5 to 4\r\nmove 4 from 1 to 4\r\nmove 19 from 1 to 9\r\nmove 6 from 6 to 2\r\nmove 12 from 9 to 1\r\nmove 1 from 8 to 6\r\nmove 1 from 9 to 4\r\nmove 4 from 4 to 8\r\nmove 1 from 6 to 5\r\nmove 1 from 5 to 3\r\nmove 2 from 8 to 9\r\nmove 5 from 4 to 6\r\nmove 5 from 9 to 4\r\nmove 1 from 4 to 3\r\nmove 2 from 2 to 9\r\nmove 1 from 6 to 5\r\nmove 1 from 6 to 9\r\nmove 7 from 1 to 5\r\nmove 1 from 3 to 1\r\nmove 2 from 8 to 3\r\nmove 1 from 5 to 7\r\nmove 2 from 9 to 8";
var inputMoves = rawInputMoves.Replace("move ", "")
                                .Replace("from ", "")
                                .Replace("to ", "")
                                .Split("\r\n")
                                .Select(a =>
                                    a.Split(" ")
                                    .Select(s =>
                                        Convert.ToInt32(s)).ToArray());

foreach (var move in inputMoves)
{
    for (int i = 0; i < move[0]; i++)
    {
        //Part 1
        var c = stacksList[move[1] - 1].Pop();
        stacksList[move[2] - 1].Push(c);

        //Part 2
        if (i == move[0] - 1)
        {
            var workStack = new Stack<char>();
            for (int j = 0; j < move[0]; j++)
                workStack.Push(stacksList2[move[1] - 1].Pop());

            while (workStack.Count != 0)
                stacksList2[move[2] - 1].Push(workStack.Pop());
        }
    }
}

//Result Part 1
Console.WriteLine(new string(stacksList.Select(a => a.Pop()).ToArray()));
//Result Part 2
Console.WriteLine(new string(stacksList2.Select(a => a.Pop()).ToArray()));
